---
- name: wait for jenkins to be available
  ansible.builtin.wait_for:
    host: "{{ _domain }}"
    port: 443
    delay: 5
    timeout: 120

- name: install jenkins plugins
  community.general.jenkins_plugin:
    name: "{{ item }}"
    url: "https://{{ _domain }}"
    url_username: "{{ jenkins_admin_user }}"
    url_password: "{{ jenkins_admin_pass }}"
  loop:
    - git
    - github-branch-source
    - github-checks
    - job-dsl
    - instance-identity
    - swarm
    - workflow-aggregator
    - pipeline-stage-view
    - pipeline-github-lib
    - configuration-as-code

- name: restart jenkins
  systemd:
    name: jenkins
    state: restarted
    daemon_reload: true
    enabled: yes
